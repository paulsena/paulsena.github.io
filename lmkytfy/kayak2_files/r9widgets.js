(function(a){function b(d,c){if(d.parent().length){d.replaceWith(c)}else{d.html(c)}}R9.extend(true,{Widget:function(e,d){this.options={executeJavaScript:true,debug:false,success:function(f){d.debug&&console.debug(f)},data:{}};if(typeof e==="string"){this.options.widget=e;jq.extend(this.options,d)}else{jq.extend(this.options,e)}d=this.options;d.data.executeJavaScript=d.executeJavaScript;if(!e){throw"Widget name is not set!"}var e=e.replace(".","/");var c=a("<div>").on("DOMNodeInsertedIntoDocument",function(){c.contents().unwrap()});a.ajax("/charm/seo/ajax/widget/"+e,{data:d.data}).done(function(f){b(c,f);d.success(f)});return c}})})(jq||jQuery);(function(){jq("body").on("change","select[name^='airlines']",function(){R9.seo.directFlights.showSection(".df"+this.value)});jq("#airlines").dropdown()})();R9.extend("SEM.overlay",{createCmp2Events:false,cmp2Controller:null,isOpen:false,airportPickerSettings:{},loadSettings:function(a){this.product=a.product||"flights";switch(this.product){case"hotels":R9.fd.hotels.Form.prototype.loadSettings.call(this,a);this.mainForm=jq(a.mainForm||document.hotels);break;case"cars":R9.fd.cars.Form.prototype.loadSettings.call(this,a);this.mainForm=jq(a.mainForm||document.cars);break;case"packagetours":R9.packagetours.Form.prototype.loadSettings.call(this,a);this.mainForm=jq(a.mainForm||document.packagetours);break;default:case"flights":R9.fd.flights.SimpleForm.prototype.loadSettings.call(this,a);this.mainForm=jq(a.mainForm||document.flights);break}this.overlayContainer=jq(".oldOverlayContainer");this.defaultTitle=jq(".searchTitle",this.e).html();this.inputs=a.inputs;this.customCopy=a.customCopy;this.width=630;this.pageOrigin=jq.extend({vertical:"F",type:"M",page1:"FD",page2:"",position:"M1"},a.pageOrigin);this.airportPickerSettings=a.airportPickerSettings||{}},bindMoreOptions:function(){},bindSmartbox:function(){if(this.bindKPackSmartbox){this.bindKPackSmartbox()}var a=this;jq("#origin, #destination",a.e).r9FlightSmarty({beforeStart:function(b){a.clearHelpText(b.element)},afterDone:function(b){a.reloadLiteCmp2Items()},clearItem:function(c){var b=c.elementNode.name==="origin";jq(b?"#origincode":"#destcode",a.e).val("")},setItem:function(d,b,c){if(!b){return}setTimeout(function(){var e=d.elementNode.name=="origin";var f=jq(e?"#origincode":"#destcode",a.e).val(b?b.id:"");var g={};a.log(["location",e?"origin":"destination"].join("/"));if(b.type=="ap"||b.type=="rail"){d.elementNode.value=b.short_str||b.str;f.val(b.id);a.checkBuzzCalendar()}else{if(b.type==="isl"){d.elementNode.value=b.str;f.val("")}else{d.elementNode.value="";f.val("");if(b.type){g={hint:b.id};if(e){jq.extend(g,R9.fd.flights.airportPickerSettings.fromOverlay,a.airportPickerSettings&&a.airportPickerSettings.from||{})}else{jq.extend(g,R9.fd.flights.airportPickerSettings.toOverlay,a.airportPickerSettings&&a.airportPickerSettings.to||{})}R9.airportPicker.show(g)}}}},1)},minWidth:a.smartboxMinWidth,recentList:a.smartboxHistory})},toggleOneWay:function(){},onSubmit:function(){R9.fd.Form.prototype.onSubmit.call(this);if(!this.isSubmitted){this.clearErrors();if(this.isValid()){var a=this.generateSearchUrl(this.e);if(a!==null){this.disableSearchButton();this.navigateToResults(a)}}else{this.showErrors(this.error)}}return false},open:function(b){if(this.isOpen){return}if(b){var c;if(jq(b).is("[data-title]")){c=jq(b).attr("data-title")}else{c=this.defaultTitle}jq(".searchTitle",this.e).html(c);this.copyFromForm(this.mainForm,b)}var a=this;window.ratesPopover=this.overlayContainer.newDialog({spinner:false,width:this.width,wrapperClass:"getRatesDialog",removeOnClose:false,viewPortClass:"search-overlay-viewport",close:function(){a.close()},opened:function(){a.clearErrors();a.overlayContainer.removeClass("hidden");if(a.cmp2Controller===null){a.cmp2Controller=new R9.CompareTo.Controller(R9.CompareTo.View.getViewFromForm(a.e),new R9.CompareTo.Model());a.cmp2Controller.changePageOrigin(a.pageOrigin);a.cmp2Controller.setShowOnFrontDoor()}a.reloadLiteCmp2Items();if(a.smBox){a.smBox.togglePlaceHolder()}}});this.isOpen=true},close:function(){this.overlayContainer.addClass("hidden");this.isOpen=false},showErrors:function(a){jq(".errors",this.e).append(a)},clearErrors:function(){jq(".errors",this.e).empty()},disableSearchButton:function(){jq("#fdimgbutton",this.e).prop("disabled",true)},enableSearchButton:function(){jq("#fdimgbutton",this.e).removeProp("disabled")},reloadLiteCmp2Items:function(){if(this.cmp2Controller!==null){this.cmp2Controller.refresh()}},copyFromForm:function(b,a){this._copyForm(b,this.e,a)},copyToForm:function(a){this._copyForm(this.e,a,null)},_copyForm:function(g,f,c){for(var b=0;b<this.inputs.length;b++){var d=this._getValue(c,this.inputs[b].data,this.inputs[b].element,g);this._setValue(d,this.inputs[b].element,f)}var a=this._getDate(c,"data-start-date","getStartDate",g);this._setDate(a,"setStartDate",f);var e=this._getDate(c,"data-end-date","getEndDate",g);this._setDate(e,"setEndDate",f);this._copyTravelers(g,f);if(this.customCopy){this.customCopy(g,f)}},_copyTravelers:function(e,d){jq(e).find(".numberHolder").each(function(h){var g=jq(this).attr("name");var k=jq(this).val();var f=".numberHolder[name="+g+"]";var j=jq(d).find(f).closest(".r9NumberBox").data("r9NumberBox");if(j!=undefined){j.setValue(parseInt(k))}});var b=jq("#travelers .r9-dropdownDialog-label",e).text();jq("#travelers .r9-dropdownDialog-label",d).text(b);for(var a=1;a<6;a++){var c=jq("select[name=child"+a+"_select]",e).val();jq("select[name=child"+a+"_select]",d).val(c)}},_getValue:function(c,d,a,b){if(jq(c).is("[data-"+d+"]")){return jq(c).attr("data-"+d)}else{return jq(a,b).val()}},_setValue:function(c,a,b){jq(a,b).val(c)},_getDate:function(c,d,a,b){if(jq(c).is("["+d+"]")){return new Date(jq(c).attr(d))}else{return jq("#travel_dates-end-wrapper",b).daterangePickerTwoFields(a)}},_setDate:function(c,a,b){jq("#travel_dates-end-wrapper",b).daterangePickerTwoFields(a,c)}});if(R9&&R9.fd){if(R9.fd.flights){R9.extend("fd.flights",{OverlayForm:function(a){a.product="flights";a.inputs=[{data:"origin",element:"input[name=origin]"},{data:"origin-code",element:"input[name=origincode]"},{data:"destination",element:"input[name=destination]"},{data:"destination-code",element:"input[name=destcode]"}];a.customCopy=function(e,d){jq(".roundtriponly",d).css("visibility",(this.getData()["oneway"]==="n")?"":"hidden");jq(d).find("#ptcChildren").val(jq(e).find("#ptcChildren").val());jq(d).find("#ptcAdults").val(jq(e).find("#ptcAdults").val());jq(d).find("#ptcSeniors").val(jq(e).find("#ptcSeniors").val());jq(d).find("#childAge1").val(jq(e).find("#childAge1").val());jq(d).find("#childAge2").val(jq(e).find("#childAge2").val());jq(d).find("#childAge3").val(jq(e).find("#childAge3").val());jq(d).find("#childAge4").val(jq(e).find("#childAge4").val());jq(d).find("#childAge5").val(jq(e).find("#childAge5").val());var c=jq(e).find("#cabin-status").text();var b=jq(e).find("#cabin").val();jq(d).find("#cabin-status").text(c);jq(d).find("#cabin option").each(function(f,g){if(jq(g).val()==b){jq(g).attr("selected","selected")}else{jq(g).removeAttr("selected")}});if(jq(e).find(".infantInLapWarning").is(":visible")){jq(d).find(".infantInLapWarning").show()}else{jq(d).find(".infantInLapWarning").hide()}};a.pageOrigin=jq.extend({vertical:"F"},a.pageOrigin||{});R9.fd.flights.SimpleForm.call(this,a)}});R9.fd.flights.OverlayForm.prototype=R9.fd.flights.SimpleForm.prototype.beget();R9.extend("fd.flights.OverlayForm.prototype",R9.SEM.overlay)}else{if(R9.fd.hotels){R9.extend("fd.hotels",{OverlayForm:function(a){a.product="hotels";a.inputs=[{data:"hid",element:"input[name=hid]"},{data:"destination",element:"input[name=location]"},{data:"destination",element:"input[name=othercity]"},{data:"destination-code",element:"input[name=citycode]"},{data:"feature",element:"input[name=amenity]"},{data:"minstars",element:"input[name=minstars]"},{data:"landmark",element:" input[name=lmid]"},{data:"propertyType",element:" input[name=filterPropertyType]"},{data:"neighborhood",element:" input[name=neighborhood]"},{data:"ambiance",element:"input[name=ambiance]"}];a.pageOrigin={vertical:"H"};R9.fd.hotels.Form.call(this,a)}});R9.fd.hotels.OverlayForm.prototype=R9.fd.hotels.Form.prototype.beget();R9.extend("fd.hotels.OverlayForm.prototype",R9.SEM.overlay)}else{if(R9.fd.cars){R9.extend("fd.cars",{OverlayForm:function(a){a.product="cars";a.inputs=[{data:"pickup",element:"input[name=location]"},{data:"pickup-code",element:"input[name=citycode1]"},{data:"dropoff",element:"input[name=location2]"},{data:"dropoff-code",element:"input[name=citycode2]"}];a.customCopy=function(e,d){var b=jq("#pickup_hour",e).val();jq("#pickup_hour",d).val(b);var c=jq("#dropoff_hour",e).val();jq("#dropoff_hour",d).val(c)};a.pageOrigin={vertical:"C"};R9.fd.cars.Form.call(this,a)}});R9.fd.cars.OverlayForm.prototype=R9.fd.cars.Form.prototype.beget();R9.extend("fd.cars.OverlayForm.prototype",R9.SEM.overlay)}else{if(R9.packagetours){R9.extend("fd.packagetours",{OverlayForm:function(a){a.product="packagetours";a.inputs=[{data:"origin",element:"input[name=origin]"},{data:"origin-code",element:"input[name=origincode]"},{data:"search-criteria",element:"input[name=searchCriteriaJson]"},{data:"start-date",element:"input[name=departDate]"},{data:"end-date",element:"input[name=returnDate]"},{data:"duration",element:"input[name=duration]"},{data:"flex-days",element:"input[name=flexDays]"}];a.customCopy=function(g,f){try{var c=jq("input[name=duration]",f).val();var d=JSON.parse(jq("input[name=searchCriteriaJson]",f).val());if(f===R9.packagetours.Globals.Form.e){R9.packagetours.Globals.Form.setDurationToAny(c);R9.packagetours.Globals.Form.setSearchCriteriaInfo(d)}else{R9.globals.semOverlay.setDurationToAny(c);R9.globals.semOverlay.setSearchCriteriaInfo(d)}}catch(b){R9.globals.semOverlay.setSearchCriteriaInfo([])}};a.pageOrigin={vertical:"P"};R9.packagetours.Form.FrontDoorForm.call(this,a)}});R9.extend("fd.packagetours.OverlayForm.prototype",jq.extend(true,{},R9.packagetours.Form.FrontDoorForm.prototype,{}));R9.extend("fd.packagetours.OverlayForm.prototype",R9.SEM.overlay)}}}}}function RegionSeoFlightsWidget(b){var c=b.id||"fdFlightRoutesCheapFlights";var a=jq("#"+c);this.options={data:{originRegion:b.origin,destinationRegion:b.destination}};this.reload=function(e){var d={};jq.extend(d,this.options);jq.extend(d.data,e);a.replaceWith(R9.Widget("flightroutes.RegionSeoFlightsWidget",d))};this.filter=function(d){this.reload({filters:d})};jq(function(){function e(h,i,g){var f=R9.globals.seoOverlay;if(!f||!i||!g){return}i.value=h.id;g.value=h.name;f.isOpen=false;f.open(null);compare2chk()}var d=document.flightsOverlay;R9.globals.seoOverlay=new R9.fd.flights.OverlayForm({e:d,mainForm:document.inlinesearchagain||document.flights,pageOrigin:{vertical:"F",page1:"RP",page2:"RT",type:"O",position:"M0"},airportPickerSettings:{from:{callback:function(f){setTimeout(function(){return e(f,d.origincode,d.origin)},1);return false},code:function(){return d.origincode.value},location:function(){return d.origin.value}},to:{callback:function(f){setTimeout(function(){return e(f,d.destcode,d.destination)},1);return false},code:function(){return d.destcode.value},location:function(){return d.destination.value}}}})});a.on("click",".booking .bookitprice",function(d){d.preventDefault();showFlightRouteSearchFormDialog(jq("#flightroutedetailsindex"+jq(this).data("flightDetailsId")))}).on("click",".booking .bookitselect > a",function(d){d.preventDefault();showFlightRouteSearchFormDialog(jq(this))})}function showFlightRouteSearchFormDialog(b){R9.globals.seoOverlay&&R9.globals.seoOverlay.open(b)}(function(b,a){b.extend("flightRoutes",{Form:function(c){this.options=a.extend.apply(this,[{},this.options,c||{}]);this.init()}});b.extend("flightRoutes.Form.prototype",{options:{form:null,originAirport:null,destinationAirport:null,departDate:null,returnDate:null,modifyButton:null,datePicker:null,initialcmp2:false,messages:{chooseOriginAirport:"",chooseDestinationAirport:"",chooseDepartDate:"",chooseReturnDate:""}},init:function(){this.bindEvents();this.bindCmp2Events();this.renewCmp2()},bindEvents:function(){var c=this;var d=this.options;var g=d.form;var f=d.originAirport;var e=d.destinationAirport;jq("button[action]").click(function(){jq(g).attr("action",jq(this).attr("action"))});f.change(function(){g.find("input[name=origin]").val(this.value);c.renewCmp2()});e.change(function(){g.find("input[name=destination]").val(this.value);c.renewCmp2()});d.modifyButton.click(function(){g.attr("action",jq(this).attr("action")).submit()});d.datePicker.daterangePicker({change:function(){c.renewCmp2()}});jq("#dialog-origincode-field").on("blur",function(h){if(this.value===""){f.val("");g.find("input[name=origin]").val("");c.renewCmp2()}});jq("#dialog-destcode-field").on("blur",function(h){if(this.value===""){e.val("");g.find("input[name=destination]").val("");c.renewCmp2()}});g.on("reloadCompareTo",function(){c.renewCmp2()});g.submit(function(m,l){if(this.origin&&this.origincode){this.origin.value=this.origincode.value}if(this.destination&&this.destcode){this.destination.value=this.destcode.value}switch(g.attr("action")){case"search":try{var j="";var k=d.messages;!f.val()&&(j+=k.chooseOriginAirport);!e.val()&&(j+=k.chooseDestinationAirport);!d.departDate.val()&&(j+=k.chooseDepartDate);!d.returnDate.val()&&(j+=k.chooseReturnDate);if(j){jq('<div class="fdSearchError"><div class="liner">'+j.replace(/\n/g,"<br/>")+"</div></div>").r9dialog({hideTitle:true,width:525});return false}var i=c.generateActionURL();new b.URL.Generator(this).setUpCookie(i);R9App.AppInstance.navigate(i,{reload:true});jq("#flightRouteSearchFormDialog").r9popover("close")}catch(h){console.error(h)}finally{m.preventDefault()}break}})},renewCmp2:function(){if(a(this.options.form).is(":visible")){var d=b.CompareTo.View.getUniqueId(this.options.form);var c=b.CompareTo.Controller.get(d);if(typeof d==="undefined"&&typeof c==="undefined"){this.bindCmp2Events()}}if(this.compareTo){this.compareTo.refresh()}},generateActionURL:function(){var e=this.options.form;var d=this.options.datePicker;if(!this.options.departDate){throw"There is no field 'depart_date'."}if(this.options.departDate.val()==""){throw"Depart date value is empty."}if(!this.options.returnDate){throw"There is no field return_date."}if(this.options.returnDate.val()==""){throw"Return date value is empty."}var c=d.daterangePicker("getStartDate").toLocalISODateString();var f=d.daterangePicker("getEndDate").toLocalISODateString();return"/flights/"+generateOaD(e.get(0),"")+"/"+c+"/"+f},bindCmp2Events:function(){var e=this.options.form.attr("name");var c="M0";if(e=="searchagain"){c="M1"}if(a(this.options.form).is(":visible")){var d=new b.CompareTo.Controller(new b.CompareTo.View.Flights(this.options.form),new b.CompareTo.Model());d.changePageOrigin({vertical:"F",type:"O",page1:"RP",page2:"RT",position:c});d.setShowOnFrontDoor();this.compareTo=d}}})})(window.R9,window.jq||window.jQuery);function evalDate(b){var a=null;jq(b.split(/\s+/)).each(function(){var c=document.getElementById(this+"-dp");!a&&(a=(c&&jq(c).datepicker("getDate"))||new Date());var d=this;if(d=d.match(/([+-]?)(\d+)D/i)){if(d[1]){a.setDate(a.getDate()+(("-"===d[1]?-1:+1)*d[2]))}else{a.setDate(1*d[2])}}});return a}R9.extend("Widgets",{Datepicker:function(a){var c=document.getElementById(a);if(!c){throw"Cannot find element with id: "+a}var g=jq(c);var e=jq(document.getElementById(g.attr("alt")||(g.attr("id")||g.attr("name"))+"-alt"));var b=g.attr("next");b=b?b+"-dp":b;var f=document.getElementById(b);if(!f&&b){throw"Cannot find next element to focus: "+b}f=jq(f);var d=g.attr("minDate");var h=g.attr("value");var i={numberOfMonths:g.attr("months")*1||1,altField:e,altFormat:"yy-mm-dd",beforeShow:function(){d&&g.datepicker("option","minDate",evalDate(d))},onSelect:function(){e.change();f.size()&&setTimeout(function(){f.datepicker("show")},0)},onClose:function(){var j=g.attr("value");if(!j){e.val("");e.change()}}};g.datepicker(i).datepicker("setDate",h)}});jq("#destinationDropdownTiles").bind("click",function(c){var b=jq(c.srcElement);if(b.hasClass("header")){var a=b.closest(".destinationDropdownTile");if(a.hasClass("photoView")){R9.Analytics.api.trackEvent("/fd/seobox/close")}else{R9.Analytics.api.trackEvent("/fd/seobox/open")}}var d=b.data("tracking");d&&R9.Analytics.api.trackEvent(d)});var KPackCrossSellCMP2=(function(b,a){return function(f){var c=b.CompareTo.View.Core.prototype.adjustDynamicOptions;var e=b.CompareTo.View.Core.prototype.bindEvents;var i=b.CompareTo.View.Core.prototype.emptyBlock;var h=b.CompareTo.View.Core.prototype.displayItemsBlock;var j=b.CompareTo.View.Core.prototype.changeItemState;var k=a(f.form);b.extend("CompareTo.View.Core.prototype",{adjustDynamicOptions:function(){var m=this,l=m.options;c.call(m);l.checkboxSelector=".checkbox"},changeItemState:function(l){var m=a(l).hasClass("checked");a(l).toggleClass("checked",!m);a(l).data("data").checked=!m;j.call(this,l)},adjustItemOverlay:function(l,m,n){a(n).find("img").on("load",function(){var o=a(n).innerWidth()-a(n).width();a(l.getFlashObject()).css({top:0,left:"-"+o+"px"});l.changeObjectSize(a(n).outerWidth(),a(n).outerHeight())})},bindEvents:function(){var m=this;var l=m.options;e.call(m);a(m.canvas).off(".WindowOpenerCheckbox");a(m.canvas).off(".changeState").on("click.changeState",".cmp2item",function(p){var o=a(this).find(l.checkboxSelector);m.changeItemState(o);if(l.limited){var n=m.getItemData(o);if((p.type=="click"&&n.checked)||p.type=="mousedown"&&!n.checked){if(!l.suppressKAYAK||(l.suppressKAYAK&&n.code.indexOf("KAYAK")!=0)){m.emitter.emit(m.events.openOneWindow,[n])}}}})},getItemData:function(l){a(l).data("data").checked=a(l).hasClass("checked");return a(l).data("data")},displayItemsBlock:function(l){if(l>0){a(f.cmp2elements,this.canvas).addClass("visible")}else{a(f.cmp2elements,this.canvas).removeClass("visible")}h.call(this,l)},emptyBlock:function(){a(f.cmp2elements,this.canvas).removeClass("visible");i.call(this)}});var g=k;var d=new b.CompareTo.Controller(new b.CompareTo.View.PackageTours(g),new b.CompareTo.Model());d.changePageOrigin({vertical:"H",type:"O",page1:"HID",page2:"",position:"M0"});a("input",g).on("change",function(){if(a(this).is(f.airportsField)){a("[name=origincode]",g).val(a(this).val())}d.refresh()})}})(window.R9,window.jq||window.jQuery);var w=(function(a){return{toggle:function(b,d){var c=a(document.getElementById(d));a(document.getElementById(b)).click(function(){c.toggleClass("visible");R9.Analytics.api.trackEvent("/city-photo/chevron/"+(c.hasClass("visible")?"open":"close"))})}}})(jq);function getItems(b){var a=[];jq("input[type=checkbox][name="+b+"]:checked").each(function(){a.push(this.value)});return a}jq(".optionItems .filterOptionOnly a").click(function(){var b=jq(this);b.closest(".optionItems").find("input[type=checkbox]:checked").prop("checked",false);var c=b.data("target");if(!c){throw"Sorry, no target no fun! (Did you forget to add 'data-target=id' attribute?)"}jq("#"+c).prop("checked",true).change()});(function(a){R9.extend(true,{Autocomplete:function(i){var c=a(document.getElementById(i+"-field"));var g=document.getElementById(i);var f=a(g);var d=c.attr("action");var h={acronyms:"true"==f.attr("highlightAcronyms"),section:"true"==f.attr("highlightSection")};function b(j,l){var k="(";if(l.section){k+="("+j.replace(/\s+/g,"|")+")|"}if(l.acronyms){k+="(\\b["+j.replace(/\s+/g,"")+"])|"}return new RegExp(k+"("+j+"))","gi")}function e(j,k){j=j.toUpperCase();return function(m,l){if(m==null||l==null||!m[k]||!l[k]){return 0}var p=String(m[k]).toUpperCase();var n=String(l[k]).toUpperCase();var q=p.indexOf(j)>=0;var o=n.indexOf(j)>=0;if(q&&!o){return -1}else{if(!q&&o){return 1}else{return p.localeCompare(n)}}}}g.reload=function(j){if(j){a.ajax(d,{data:{value:j}}).done(function(k){c.val(k);a(g).val(j)})}};g.reload(f.val());c.autocomplete({focus:function(j,k){c.val(k.item.label);f.val(k.item.value);return false},source:function(k,j){a.ajax(d,{data:{term:k.term}}).done(function(l){l=JSON.parse(l);l.sort(e(k.term,"label"));j(l)})},select:function(j,k){c.val(k.item.label).change();f.val(k.item.value).change();return false}});c.autocomplete("widget").addClass("smartbox");c.data("autocomplete")._renderItem=function(k,m){var l=b(this.term,h);var j=m.label&&m.label.replace(l,"<b>$1</b>");return a("<li>").data("item.autocomplete",m).append(a("<a>").html(j)).appendTo(k)};c.click(function(){c.autocomplete("search",f.val());c.select()})}})})(jq||jQuery);
